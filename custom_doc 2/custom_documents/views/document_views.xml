<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Document List View -->
    <record id="view_custom_document_list" model="ir.ui.view">
        <field name="name">custom.document.list</field>
        <field name="model">custom.document</field>
        <field name="arch" type="xml">
            <!-- narrow class keeps the first 2 icon columns tight -->
            <list string="Documents" js_class="custom_document_list" class="o_list_compact" delete="0">
                <!-- hidden helpers for domain evaluation -->
                <field name="is_starred" column_invisible="1"/>
                <field name="file_kind" column_invisible="1"/>

                <!-- ⭐ Star / Unstar -->
                <button name="action_toggle_star" type="object" string=" " title="Unstar"
                        icon="fa-star" class="btn btn-link p-0"
                        invisible="not is_starred"/>
                <button name="action_toggle_star" type="object" string=" " title="Star"
                        icon="fa-star-o" class="btn btn-link p-0"
                        invisible="is_starred"/>

                <!-- Type icon -->
                <button name="action_view_file" type="object" string=" " title="Open PDF"
                        icon="fa-file-pdf-o" class="btn btn-link p-0 text-danger"
                        invisible="file_kind != 'pdf'"/>
                <button name="action_download" type="object" string=" " title="Open file"
                        icon="fa-file-o" class="btn btn-link p-0"
                        invisible="file_kind != 'file'"/>
                <button name="action_download" type="object" string=" " title="Open link"
                        icon="fa-link" class="btn btn-link p-0"
                        invisible="file_kind != 'url'"/>

                <!-- Regular columns -->
                <field name="name" string="Document Name"/>
                <field name="folder_id" string="Folder"/>
                <field name="user_id" widget="many2one_avatar_user" string="Owner"/>
                <field name="write_date" string="Last Updated on" optional="show"/>
                <field name="file_size" string="File Size" optional="show"/>
            </list>
        </field>
    </record>

    <!-- Document Search View -->
    <record id="view_custom_document_search" model="ir.ui.view">
        <field name="name">custom.document.search</field>
        <field name="model">custom.document</field>
        <field name="arch" type="xml">
            <search string="Search Documents">
                <field name="name" string="Document" filter_domain="['|', ('name', 'ilike', self), ('description', 'ilike', self)]"/>
                <field name="folder_id"/>
                <field name="user_id"/>
                <field name="tag_ids"/>

                <filter string="My Documents" name="my_documents" domain="[('user_id', '=', uid)]"/>
                <separator/>
                <filter string="Files" name="files" domain="[('document_type', '=', 'file')]"/>
                <filter string="URLs" name="urls" domain="[('document_type', '=', 'url')]"/>
                <separator/>
                <filter string="Locked" name="locked" domain="[('is_locked', '=', True)]"/>

                <group expand="0" string="Group By">
                    <filter string="Type" name="type" context="{'group_by': 'document_type'}"/>
                    <filter string="Folder" name="folder" context="{'group_by': 'folder_id'}"/>
                    <filter string="Owner" name="owner" context="{'group_by': 'user_id'}"/>
                    <filter string="Creation Date" name="create_date" context="{'group_by': 'create_date:month'}"/>
                </group>
                
                <!-- LEFT SIDEBAR -->
                <searchpanel>
                    <!-- “All” (optional; selecting nothing is “All” anyway) -->
                    <filter name="all" string="All" domain="[]" icon="fa-sitemap"/>

                    <!-- Company tree (hierarchical) -->
                    <field name="folder_id"
                        select="one"
                        icon="fa-building"
                        enable_counters="1"
                        domain="[('id','child_of', ctx.get('doc_company_root_id'))]"/>

                    <!-- Shortcuts -->
                    <filter name="my_drive" string="My Drive"
                            domain="[('user_id','=', uid)]" icon="fa-user"/>

                    <filter name="shared_with_me" string="Shared with me"
                            domain="[('message_follower_ids.partner_id','=', ctx.get('my_partner_id'))]"
                            icon="fa-users"/>

                    <filter name="recent" string="Recent"
                            domain="[('write_date','>=', ctx.get('recent_from'))]"
                            icon="fa-clock-o"/>

                    <filter name="trash" string="Trash"
                            domain="[('active','=', False)]" icon="fa-trash"/>
                </searchpanel>

            </search>
        </field>
    </record>

    <record id="sa_open_documents_with_sidebar" model="ir.actions.server">
        <field name="name">Documents</field>
        <field name="model_id" ref="model_custom_document"/>
        <field name="state">code</field>
        <field name="code">action = env['custom.document'].action_open_with_sidebar()</field>
    </record>

    <!-- Modified Folder List View with Action Button -->
    <record id="view_custom_document_folder_list" model="ir.ui.view">
        <field name="name">custom.document.folder.list</field>
        <field name="model">custom.document.folder</field>
        <field name="arch" type="xml">
            <list string="Folders" js_class="custom_folder_list">
                <!-- Action button to view documents in folder -->
                <button name="action_view_folder_documents" type="object" string="" title="View Documents"
                        icon="fa-folder-open" class="btn btn-link p-0"/>
                
                <field name="complete_name"/>
                <field name="user_id"/>
                <field name="document_count"/>
            </list>
        </field>
    </record>

  

    <!-- Action to view documents in a specific folder -->
    <record id="action_folder_documents" model="ir.actions.act_window">
        <field name="name">Folder Documents</field>
        <field name="res_model">custom.document</field>
        <field name="view_mode">list</field>
        <field name="views" eval="[(ref('view_custom_document_list'), 'list')]"/>
        <field name="search_view_id" ref="view_custom_document_search"/>
        <field name="domain">[('folder_id', '=', active_id)]</field>
        <field name="context">{'default_folder_id': active_id}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">No documents in this folder yet</p>
            <p>Upload files or add URL links to this folder</p>
        </field>
    </record>

    <!-- Main Document Action -->
    <record id="action_custom_document" model="ir.actions.act_window">
        <field name="name">Documents</field>
        <field name="res_model">custom.document</field>
        <field name="view_mode">list</field>
        <field name="views" eval="[(ref('view_custom_document_list'), 'list')]"/>
        <field name="search_view_id" ref="view_custom_document_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Create your first document</p>
            <p>Upload files or add URL links to organize your documents</p>
        </field>
    </record>

    <!-- Modified Folder Action - Option 1: Keep folder management -->
    <record id="action_custom_document_folder" model="ir.actions.act_window">
        <field name="name">Folders</field>
        <field name="res_model">custom.document.folder</field>
        <field name="view_mode">list</field>
        <field name="views" eval="[(ref('view_custom_document_folder_list'), 'list')]"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Create your first folder</p>
            <p>Organize your documents in folders. Click the folder icon to view documents inside.</p>
        </field>
    </record>

    <!-- Alternative: Direct folder-to-documents action (Option 2) -->
    <record id="action_browse_folders" model="ir.actions.act_window">
        <field name="name">Browse by Folder</field>
        <field name="res_model">custom.document</field>
        <field name="view_mode">list</field>
        <field name="views" eval="[(ref('view_custom_document_list'), 'list')]"/>
        <field name="search_view_id" ref="view_custom_document_search"/>
        <field name="context">{'search_default_folder': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">No documents found</p>
            <p>Use the folder filter to browse documents by folder</p>
        </field>
    </record>
</odoo>
<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <!-- =========================================================
       SHARE LINE CARD VIEW (Custom display like owner)
       ========================================================= -->
  <record id="view_custom_document_share_line_card" model="ir.ui.view">
    <field name="name">custom.document.share.line.card</field>
    <field name="model">custom.document.share.line</field>
    <field name="arch" type="xml">
      <list editable="bottom" delete="1" create="0" class="o_share_line_cards">
        
        <!-- Avatar Column -->
        <field name="partner_id" 
               widget="image"
               nolabel="1"
               readonly="1"
               class="o_avatar_cell"
               options="{'size': [40, 40], 'preview_image': 'avatar_128'}"/>
        
        <!-- Name & Email Column -->
        <field name="partner_id" 
               string="Person"
               readonly="1" 
               options="{'no_open': True}"/>
        
        <field name="email" 
               string="Email"
               readonly="1" 
               optional="show"/>
        
        <!-- Role Column -->
        <field name="role"
               string="Access Level"
               widget="badge"
               decoration-info="role == 'viewer'"
               decoration-warning="role == 'commenter'"
               decoration-success="role == 'editor'"/>
        
        <!-- Date Column -->
        <field name="create_date" 
               string="Shared On" 
               readonly="1" 
               optional="hide"/>
      </list>
    </field>
  </record>

  <!-- =========================================================
       SHARE LINE LIST (Odoo 18 uses <list>, not <tree>)
       ========================================================= -->
  <record id="view_custom_document_share_line_list" model="ir.ui.view">
    <field name="name">custom.document.share.line.list</field>
    <field name="model">custom.document.share.line</field>
    <field name="arch" type="xml">
      <list editable="bottom" delete="1" create="0">
        <field name="partner_id" readonly="1"/>
        <field name="email" readonly="1" optional="show"/>
        <field name="role"
               widget="badge"
               decoration-info="role == 'viewer'"
               decoration-warning="role == 'commenter'"
               decoration-success="role == 'editor'"/>
        <field name="create_date" string="Shared On" readonly="1" optional="hide"/>
      </list>
    </field>
  </record>

  <!-- =========================================================
       SHARE LINE FORM (for safety / opening a single line)
       ========================================================= -->
  <record id="view_custom_document_share_line_form" model="ir.ui.view">
    <field name="name">custom.document.share.line.form</field>
    <field name="model">custom.document.share.line</field>
    <field name="arch" type="xml">
      <form string="Share Access" create="0">
        <sheet>
          <group>
            <field name="partner_id" readonly="1"/>
            <field name="email" readonly="1"/>
            <field name="role"/>
            <field name="create_date" readonly="1"/>
          </group>
        </sheet>
      </form>
    </field>
  </record>

  <!-- =========================================================
       SHARE WIZARD (Google Docs‚Äìstyle) - FIXED
       ========================================================= -->
  <record id="view_custom_document_share_wizard_form" model="ir.ui.view">
    <field name="name">custom.document.share.wizard.form</field>
    <field name="model">custom.document.share.wizard</field>
    <field name="arch" type="xml">
      <form string="Share" create="0" edit="0" delete="0">
        <sheet>
          <group>
            <!-- ============ ADD PEOPLE SECTION ============ -->
            <group string="Add People" class="mb-3">
              <label for="partner_ids" string="People"/>
              <div class="o_row">
                <field name="partner_ids"
                       widget="many2many_tags"
                       placeholder="Enter name or email..."
                       options="{'no_create_edit': True, 'no_quick_create': True}"
                       class="oe_inline"
                       nolabel="1"/>
              </div>

              <field name="role"
                     widget="radio"
                     options="{'horizontal': True}"/>

              <button name="action_add_people"
                      type="object"
                      string="Add People"
                      class="btn-primary"
                      invisible="not partner_ids"/>
            </group>
              <!-- Hidden fields -->
          <field name="owner_user_id" invisible="1"/>
          <field name="owner_partner_id" invisible="1"/>
          <field name="owner_email" invisible="1"/>
          <field name="owner_name" invisible="1"/>

       <!-- ============ PEOPLE WITH ACCESS SECTION (styled like screenshot) ============ -->
          <group string="People with access">
            <div class="o_share_people_table">

              <!-- Owner row -->
              <div class="o_share_owner_row" invisible="not owner_partner_id">
                <div class="o_owner_left">
                  <field name="owner_partner_id"
                        widget="image"
                        nolabel="1"
                        readonly="1"
                        class="o_avatar o_avatar_circle"
                        options="{'size': [24, 24], 'preview_image': 'avatar_128'}"/>
                  <div class="o_owner_text">
                    <span class="o_owner_name">
                      <field name="owner_name" nolabel="1" readonly="1"/>
                    </span>
                
                  </div>
                </div>
                <div class="o_owner_right">
                  <span class="badge bg-primary">Owner</span>
                </div>
              </div>

              <!-- People list -->
                  <field name="people_ids" nolabel="1" context="{'default_document_id': document_id}">
                    <list class="o_share_people_inline_list" editable="bottom" create="0" delete="1">
                      <!-- Avatar only (hide the text part via CSS) -->
                      <field name="partner_id"
                            nolabel="1"
                            widget="many2one_avatar"
                            class="col_avatar"
                            options="{'no_open': True}"
                            readonly="1"/>



                      <!-- Access level (badge widget renders its own <span>) -->
                      <field name="role"
                            string="Access level"
                            widget="selection"
                            decoration-primary="role == 'owner'"
                            decoration-info="role == 'viewer'"
                            decoration-warning="role == 'commenter'"
                            decoration-success="role == 'editor'"/>
                      <!-- Delete icon column is auto-provided by delete="1" -->
                    </list>
                  </field>


           

            </div>
          </group>

          </group>


          <group>

             <!-- In views/share_views.xml -->
<!-- REPLACE the "General Access" group section with this: -->

<group string="General Access">
  <field name="share_access"
         widget="radio"
         options="{'horizontal': False}"/>

  <!-- Authenticated Links Section -->
  <div class="mt-3">
    <div class="mb-2">
      <strong>üîí Internal Links (Require Login)</strong>
      <div class="text-muted small">
        Users must be logged into Odoo to access these links
      </div>
    </div>
    
    <div class="d-flex gap-2 mb-2">
      <button name="action_copy_view_link"
              type="object"
              string="Copy View Link"
              icon="fa-eye"
              class="btn btn-secondary btn-sm"
              invisible="not view_link"/>
      
      <button name="action_copy_edit_link"
              type="object"
              string="Copy Edit Link"
              icon="fa-edit"
              class="btn btn-secondary btn-sm"
              invisible="not edit_link"/>
    </div>
  </div>

  <!-- Public Links Section -->
  <div class="mt-3">
    <div class="mb-2">
      <strong>üåê Public Links (No Login Required)</strong>
      <div class="text-muted small">
        Anyone with these links can access the document without logging in
      </div>
    </div>
    
    <div class="d-flex gap-2 mb-2">
      <button name="action_copy_public_view_link"
              type="object"
              string="Copy Public View Link"
              icon="fa-globe"
              class="btn btn-success btn-sm"
              invisible="not public_view_link"/>
      
      <button name="action_copy_public_edit_link"
              type="object"
              string="Copy Public Download Link"
              icon="fa-download"
              class="btn btn-success btn-sm"
              invisible="not public_edit_link"/>
    </div>
    
    <div class="alert alert-info small mt-2" 
         invisible="public_view_link or public_edit_link">
      <i class="fa fa-info-circle"/> 
      To enable public links, set General Access to 
      <strong>"Anyone with link"</strong>
    </div>
  </div>

  <!-- Info Box -->
  <div class="alert alert-warning small mt-3">
    <strong>Link Types:</strong>
    <ul class="mb-0 ps-3">
      <li><strong>Internal Links:</strong> Direct content URLs. Users must log in first.</li>
      <li><strong>Public Links:</strong> Token-based URLs. Work without login (if enabled).</li>
    </ul>
  </div>
</group>
          </group>


       

           

   

        </sheet>

        <footer>
          <button string="Done" class="btn-primary" special="cancel"/>
        </footer>
      </form>
    </field>
  </record>

  <!-- =========================================================
       SHARE WIZARD ACTION (opens in modal)
       ========================================================= -->
  <record id="action_custom_document_share_wizard" model="ir.actions.act_window">
    <field name="name">Share Document</field>
    <field name="res_model">custom.document.share.wizard</field>
    <field name="view_mode">form</field>
    <field name="target">new</field>
  </record>

</odoo>
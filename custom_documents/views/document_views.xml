<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ===========================
         Document List View
         =========================== -->
    <record id="view_custom_document_list" model="ir.ui.view">
        <field name="name">custom.document.list</field>
        <field name="model">custom.document</field>
        <field name="arch" type="xml">
            <list string="Documents"
                  js_class="custom_document_list"
                  class="o_list_compact custom_document_list"
                  delete="0"
                  create="0">

                <field name="is_starred" column_invisible="1"/>
                <field name="file_kind" column_invisible="1"/>

                <!-- â­ Star / Unstar -->
                <button name="action_toggle_star" type="object" string=" " title="Unstar"
                        icon="fa-star" class="btn btn-link p-0 starred"
                        invisible="not is_starred"/>
                <button name="action_toggle_star" type="object" string=" " title="Star"
                        icon="fa-star-o" class="btn btn-link p-0 starred"
                        invisible="is_starred"/>

                <!-- Type-specific actions -->
                <button name="action_view_file" type="object" string=" " title="Open PDF"
                        icon="fa-file-pdf-o" class="btn btn-link p-0 text-danger starred"
                        invisible="file_kind != 'pdf'"/>
                <button name="action_download" type="object" string=" " title="Open file"
                        icon="fa-file-o" class="btn btn-link p-0 starred"
                        invisible="file_kind != 'file'"/>
                <button name="action_download" type="object" string=" " title="Open link"
                        icon="fa-link" class="btn btn-link p-0 starred"
                        invisible="file_kind != 'url'"/>

                <!-- Regular columns -->
                <field name="reference_number" string="Ref No." optional="show"/>
                <field name="name" string="Name"/>
                <field name="folder_id" string="Folder"/>
                <field name="user_id" widget="many2one_avatar_user" string="Owner"/>
                <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" optional="show"/>
                <field name="company_id" string="Contact" groups="base.group_multi_company" optional="show"/>
            
                <field name="file_size" string="File Size" optional="hide"/>

                   <field name="write_datetime_display" string="Last Updated on" readonly="1"/>
    <!-- Keep write_date hidden if you ever want to show it or use it elsewhere
    <field name="write_date" invisible="1"/> -->
  
                <button name="action_share_document"
                            type="object"
                            string=" "
                            title="Share"
                            icon="fa-share"/>
                <button name="action_rename"
                            type="object"
                            string=" "
                            title="Rename"
                            icon="fa-solid fa-pencil"/>
                <button name="action_download"
                            type="object"
                            string=" "
                            title="Download"
                            icon="fa-download"/>


            </list>
        </field>
    </record>

    <!-- =========================================================
         RICH DOCUMENT FORM VIEW (the only form we keep/use)
         ========================================================= -->
    <record id="view_custom_document_form_rich" model="ir.ui.view">
        <field name="name">custom.document.form.rich</field>
        <field name="model">custom.document</field>
        <field name="arch" type="xml">
            <form string="Document" create="0">
                <header>
                    <!-- Quick Actions -->
                    <button name="action_download"
                            type="object"
                            string="Download"
                            class="btn-primary"
                            icon="fa-download"
                            invisible="document_type != 'file'"/>

                    <button name="action_share_document"
                            type="object"
                            string="Share"
                            class="btn-secondary"
                            icon="fa-share-alt"/>

                     <button name="action_open_upload_wizard"
                            type="object"
                            string="Edit"
                            class="btn-secondary"
                            icon="fa-pencil"/>

                    <button name="action_toggle_star"
                            type="object"
                            icon="fa-star"
                            class="btn-warning"
                            invisible="not is_starred"
                            help="Unstar"/>
                            
                    <button name="action_toggle_star"
                            type="object"
                            icon="fa-star-o"
                            class="btn-secondary"
                            invisible="is_starred"
                            help="Star"/>
                </header>

                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <!-- Shared Status -->
                        <button name="action_share_document"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-share-alt"
                                invisible="not is_shared">
                            <field name="shared_with_count" widget="statinfo" string="Shared With"/>
                        </button>

                        <!-- Lock Status -->
                        <button name="action_lock"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-lock"
                                invisible="not is_locked">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">Locked by</span>
                                <span class="o_stat_value">
                                    <field name="locked_by" widget="many2one_avatar_user"/>
                                </span>
                            </div>
                        </button>

                        <!-- File Size -->
                        <button class="oe_stat_button"
                                icon="fa-file-o"
                                invisible="document_type != 'file'">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">File Size</span>
                                <span class="o_stat_value">
                                    <field name="file_size" widget="integer"/>
                                </span>
                            </div>
                        </button>
                    </div>


                    <!-- Tabs -->
                    <notebook>
                        <!-- PREVIEW TAB -->
                        <page string="Preview" name="preview">
                            <group>

                                <!-- PDF Viewer -->
                                <div class="o_pdf_readonly">
                                    <field name="file"
                                        filename="file_name"
                                        widget="pdf_viewer"
                                        invisible="not is_pdf"
                                        options="{'height': 800}"
                                        nolabel="1"/>
                                </div>

                                <!-- Image Viewer -->
                                <div invisible="is_pdf or document_type != 'file'" class="text-center">
                                    <field name="file"
                                           widget="image"
                                           options="{'size': [0, 600]}"
                                           nolabel="1"/>
                                </div>

                                <!-- Other Files -->
                                <div invisible="is_pdf or document_type != 'file'"
                                     class="text-center py-5">
                                    <i class="fa fa-file-o fa-5x text-muted mb-3"></i>
                                    <p class="lead">Preview not available for this file type</p>
                                    <button name="action_download"
                                            type="object"
                                            string="Download File"
                                            class="btn btn-primary btn-lg"
                                            icon="fa-download"/>
                                </div>

                                <!-- URL Display -->
                                <div invisible="document_type != 'url'" class="text-center py-5">
                                    <i class="fa fa-link fa-5x text-muted mb-3"></i>
                                    <p class="lead">URL Link</p>
                                    <field name="url" widget="url" nolabel="1" class="h4"/>
                                    <br/>
                                    <button name="action_download"
                                            type="object"
                                            string="Open Link"
                                            class="btn btn-primary btn-lg"
                                            icon="fa-external-link"/>
                                </div>
                            </group>
                        </page>

                        <!-- DETAILS TAB -->
                        <page string="Details" name="details">
                            <group>
                                <group string="File Information" invisible="document_type != 'file'">
                                    <field name="document_type" readonly="1"/>
                                    <field name="file_name" readonly="1"/>
                                    <field name="mimetype" readonly="1"/>
                                    <field name="is_pdf" invisible="1"/>
                                </group>

                                <group string="URL Information" invisible="document_type != 'url'">
                                    <field name="document_type" readonly="1"/>
                                    <field name="url" widget="url"/>
                                </group>

                                <group string="Organization">
                                    <field name="folder_id" options="{'no_create': True}"/>
                                    <field name="tag_ids"
                                           widget="many2many_tags"
                                           options="{'color_field': 'color', 'no_quick_create': False}"/>
                                    <field name="priority" widget="priority"/>
                                </group>

                                <group string="Ownership">
                                    <field name="user_id"
                                           widget="many2one_avatar_user"
                                           readonly="1"/>
                                    <field name="company_id"
                                           groups="base.group_multi_company"
                                           readonly="1"/>
                                </group>

                                <group string="Timestamps">
                                    <field name="create_date" readonly="1"/>
                                    <field name="write_date" readonly="1"/>
                                </group>
                            </group>

                            <group string="Description">
                                <field name="description"
                                       nolabel="1"
                                       placeholder="Add a description for this document..."/>
                            </group>
                        </page>

                        <!-- SHARING TAB -->
                        <page string="Sharing" name="sharing">
                            <group>
                                <group string="Sharing Status">
                                    <field name="share_access"
                                           widget="badge"
                                           decoration-info="share_access == 'private'"
                                           decoration-success="share_access == 'internal'"/>
                                    <field name="is_shared" invisible="1"/>
                                </group>
                            </group>

                            <!-- Owner Info -->
                            <group string="Document Owner">
                                <div class="d-flex align-items-center mb-3">
                                    <field name="user_id"
                                           widget="many2one_avatar_user"
                                           readonly="1"
                                           nolabel="1"
                                           options="{'display_avatar_name': True}"/>
                                </div>
                            </group>

                            <!-- People with Access -->
                            <group string="People with Access" invisible="not share_line_ids">
                                <field name="share_line_ids" nolabel="1">
                                    <list editable="bottom" delete="1" create="0">
                                        <field name="partner_id"
                                               widget="many2one_avatar"
                                               readonly="1"
                                               options="{'no_open': True}"/>
                                        <!-- Optional if your line model has it -->
                                        <field name="email" readonly="1" optional="show"/>
                                        <field name="create_date" string="Shared On" readonly="1"/>
                                    </list>
                                </field>
                            </group>

                            <!-- No Shares Message -->
                            <div class="alert alert-info" invisible="share_line_ids">
                                <h4><i class="fa fa-lock"/> This document is private</h4>
                                <p>Only you can access this document.</p>
                                <p class="mb-0">
                                    Click the <strong>Share</strong> button in the header
                                    to share with other users.
                                </p>
                            </div>
                        </page>
                    </notebook>
                </sheet>

                <!-- Chatter -->
               <chatter>
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </chatter>
            </form>
        </field>
    </record>

    <!-- ===============================================
         Document Search View with Hierarchical Searchpanel
         =============================================== -->
    <record id="view_custom_document_search" model="ir.ui.view">
        <field name="name">custom.document.search</field>
        <field name="model">custom.document</field>
        <field name="arch" type="xml">
            <search string="Search Documents">
                <field name="name" string="Document" filter_domain="['|', ('name', 'ilike', self), ('description', 'ilike', self)]"/>
                <field name="folder_id"/>
                <field name="user_id"/>
                <field name="tag_ids"/>

                <!-- Filters for virtual folders -->
                <filter string="My Drive" name="my_drive"
                        domain="[('user_id', '=', uid), ('active', '=', True)]"/>
                <filter string="Shared with me" name="shared_with_me"
                        domain="[('message_follower_ids.partner_id.user_ids', 'in', [uid]), ('user_id', '!=', uid), ('active', '=', True)]"/>
                <filter string="Recent" name="recent"
                        domain="[('write_date', '&gt;=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d')), ('active', '=', True)]"/>
                <filter string="Trash" name="trash"
                        domain="[('active', '=', False)]"
                        context="{'active_test': False}"/>

                <group expand="0" string="Group By">
                    <filter string="Type"          name="type"   context="{'group_by': 'document_type'}"/>
                    <filter string="Folder"        name="folder" context="{'group_by': 'folder_id'}"/>
                    <filter string="Owner"         name="owner"  context="{'group_by': 'user_id'}"/>
                    <filter string="Creation Date" name="create" context="{'group_by': 'create_date:month'}"/>
                </group>

                <!-- LEFT SIDEBAR with Hierarchical Folders -->
                <searchpanel>
                
                    <field name="folder_id"
                           string="Folders" select="one"
                           icon="fa-folder-o"
                           enable_counters="1"
                           expand="1"
                           hierarchize="1"/>
                           
                 
                </searchpanel>
            </search>
        </field>
    </record>

    

    <!-- ===========================
         Main Document Action
         =========================== -->
    <record id="action_custom_document" model="ir.actions.act_window">
        <field name="name">Documents</field>
        <field name="res_model">custom.document</field>
        <field name="view_mode">list,form</field>
        <field name="views"
               eval="[(ref('view_custom_document_list'), 'list'),
                      (ref('view_custom_document_form_rich'), 'form')]"/>
        <field name="search_view_id" ref="view_custom_document_search"/>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Create your first document</p>
            <p>Upload files or add URL links to organize your documents</p>
        </field>
    </record>

    <!-- ===========================
         Optional shortcut actions (all point to rich form)
         =========================== -->
    <record id="action_my_drive" model="ir.actions.act_window">
        <field name="name">My Drive</field>
        <field name="res_model">custom.document</field>
        <field name="view_mode">list,form</field>
        <field name="views" eval="[(ref('view_custom_document_list'), 'list'),
                                   (ref('view_custom_document_form_rich'), 'form')]"/>
        <field name="search_view_id" ref="view_custom_document_search"/>
        <field name="context">{'search_default_my_drive': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">No documents in your drive yet</p>
            <p>Upload files or add URL links to start organizing your personal documents</p>
        </field>
    </record>

    <record id="action_shared_with_me" model="ir.actions.act_window">
        <field name="name">Shared with Me</field>
        <field name="res_model">custom.document</field>
        <field name="view_mode">list,form</field>
        <field name="views" eval="[(ref('view_custom_document_list'), 'list'),
                                   (ref('view_custom_document_form_rich'), 'form')]"/>
        <field name="search_view_id" ref="view_custom_document_search"/>
        <field name="context">{'search_default_shared_with_me': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">No documents shared with you</p>
            <p>Documents shared with you will appear here</p>
        </field>
    </record>

    <record id="action_recent" model="ir.actions.act_window">
        <field name="name">Recent</field>
        <field name="res_model">custom.document</field>
        <field name="view_mode">list,form</field>
        <field name="views" eval="[(ref('view_custom_document_list'), 'list'),
                                   (ref('view_custom_document_form_rich'), 'form')]"/>
        <field name="search_view_id" ref="view_custom_document_search"/>
        <field name="context">{'search_default_recent': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">No recent documents</p>
            <p>Documents modified in the last 7 days will appear here</p>
        </field>
    </record>

    <record id="action_trash" model="ir.actions.act_window">
        <field name="name">Trash</field>
        <field name="res_model">custom.document</field>
        <field name="view_mode">list,form</field>
        <field name="views" eval="[(ref('view_custom_document_list'), 'list'),
                                   (ref('view_custom_document_form_rich'), 'form')]"/>
        <field name="search_view_id" ref="view_custom_document_search"/>
        <field name="context">{'search_default_trash': 1, 'active_test': False}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Trash is empty</p>
            <p>Deleted documents will appear here</p>
        </field>
    </record>

    <!-- ===========================
         Folder List
         =========================== -->
    <record id="view_custom_document_folder_list" model="ir.ui.view">
        <field name="name">custom.document.folder.list</field>
        <field name="model">custom.document.folder</field>
        <field name="arch" type="xml">
            <list string="Folders" js_class="custom_folder_list">
                <button name="action_view_folder_documents" type="object" string="" title="View Documents"
                        icon="fa-folder-open" class="btn btn-link p-0"/>
                <field name="name"/>
                
                <field name="user_id"/>
                <field name="document_count"/>
            </list>
        </field>
    </record>

    <record id="action_folder_documents" model="ir.actions.act_window">
        <field name="name">Folder Documents</field>
        <field name="res_model">custom.document</field>
        <field name="view_mode">list,form</field>
        <field name="views" eval="[(ref('view_custom_document_list'), 'list'),
                                   (ref('view_custom_document_form_rich'), 'form')]"/>
        <field name="search_view_id" ref="view_custom_document_search"/>
        <field name="domain">[('folder_id', '=', active_id)]</field>
        <field name="context">{'default_folder_id': active_id}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">No documents in this folder yet</p>
            <p>Upload files or add URL links to this folder</p>
        </field>
    </record>

    <record id="action_custom_document_folder" model="ir.actions.act_window">
        <field name="name">Folders</field>
        <field name="res_model">custom.document.folder</field>
        <field name="view_mode">list</field>
        <field name="views" eval="[(ref('view_custom_document_folder_list'), 'list')]"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Create your first folder</p>
            <p>Organize your documents in folders. Click the folder icon to view documents inside.</p>
        </field>
    </record>

</odoo>
